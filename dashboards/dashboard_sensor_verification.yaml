title: Sensor Verification
path: sensor-verification
icon: mdi:check-decagram
badges: []
cards:
  # ===========================================================================
  # OVERVIEW CARD
  # ===========================================================================
  - type: markdown
    title: ğŸ“‹ Sensor Verification Overview
    content: |
      ## Purpose
      This dashboard traces data flow through all sensor calculation layers to identify issues.

      ## Recent Changes (2025-11-12)
      - âœ… Created `sensor.cx_output_power_interval` (integration sensor for thermal energy)
      - âœ… Created cycle tracking sensors (current/last duration, cycle remaining)
      - âœ… Created `sensor.heat_pump_last_cycle_cop` (COP at cycle completion)
      - âœ… Fixed `radiant_sensors.yaml` template syntax errors

      ## Known Issues
      - âš ï¸ Input energy utility meters have corrupted historical state (need reset)
      - âš ï¸ Distribution efficiency shows low when in "Heat + DHW" mode (expected - energy goes to hot water)

      ## Data Flow
      ```
      Modbus â†’ Raw Sensors (cx_sensors.yaml)
        â†“
      Calculated Power (electrical & thermal)
        â†“
      Integration Sensors (legacy_sensors.yaml) â†’ Energy (kWh)
        â†“
      Utility Meters (utility_meters.yaml) â†’ Hourly/Daily/Monthly
        â†“
      Optimization Sensors (cx_optimization_sensors.yaml) â†’ Mode filtering
      ```

      **Last Updated:** {{ now().strftime('%Y-%m-%d %H:%M:%S') }}

  # ===========================================================================
  # CARD 1: RAW HEAT PUMP SENSORS
  # ===========================================================================
  - type: markdown
    title: ğŸ”Œ Raw Heat Pump Sensors (cx_sensors.yaml)
    content: |
      ## Primary Inputs (Direct from Modbus)
      | Sensor | Value | Status |
      |--------|-------|--------|
      | Operating Mode | {{ states('sensor.heat_pump_operating_mode') }} | {{ 'âœ…' if states('sensor.heat_pump_operating_mode') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Inlet Temp | {{ states('sensor.heat_pump_inlet_temperature') }}Â°F | {{ 'âœ…' if states('sensor.heat_pump_inlet_temperature') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Outlet Temp | {{ states('sensor.heat_pump_outlet_temperature') }}Â°F | {{ 'âœ…' if states('sensor.heat_pump_outlet_temperature') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Delta T | {{ states('sensor.heat_pump_delta_t') }}Â°F | {{ 'âœ…' if states('sensor.heat_pump_delta_t') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Flow Rate | {{ states('sensor.cx50_pump_flow_gpm') }} GPM | {{ 'âœ…' if states('sensor.cx50_pump_flow_gpm') | float(0) > 0 else 'âš ï¸ Zero/Low' }} |
      | Flow Rate | {{ states('sensor.cx50_pump_flow_lpm') }} LPM | {{ 'âœ…' if states('sensor.cx50_pump_flow_lpm') | float(0) > 0 else 'âš ï¸ Zero/Low' }} |
      | AC Voltage | {{ states('sensor.cx50_input_ac_voltage') }}V | {{ 'âœ…' if states('sensor.cx50_input_ac_voltage') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | AC Current | {{ states('sensor.cx50_input_ac_current') }}A | {{ 'âœ…' if states('sensor.cx50_input_ac_current') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Compressor Freq | {{ states('sensor.cx50_compressor_frequency') }} Hz | {{ 'âœ…' if states('sensor.cx50_compressor_frequency') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Compressor Speed | {{ states('sensor.heat_pump_compressor_speed') }}% | {{ 'âœ…' if states('sensor.heat_pump_compressor_speed') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Fan Speed | {{ states('sensor.heat_pump_fan_speed') }}% | {{ 'âœ…' if states('sensor.heat_pump_fan_speed') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      ## Calculated Power (V Ã— I)
      | Sensor | Value | Formula | Status |
      |--------|-------|---------|--------|
      | Electrical Input | {{ states('sensor.heat_pump_electrical_power_input') }}W | V Ã— I | {{ 'âœ…' if states('sensor.heat_pump_electrical_power_input') | float(0) > 0 or is_state('binary_sensor.heat_pump_running', 'off') else 'âš ï¸' }} |
      | Electrical Input | {{ states('sensor.heat_pump_electrical_power_input_kw') }}kW | / 1000 | {{ 'âœ…' if states('sensor.heat_pump_electrical_power_input_kw') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      ## Calculated Thermal (Q = á¹ Ã— Cp Ã— Î”T)
      | Sensor | Value | Dependencies | Status |
      |--------|-------|--------------|--------|
      | Thermal Output | {{ states('sensor.heat_pump_thermal_power_output') }}W | Flow, Î”T, Cp, Ï | {{ 'âœ…' if states('sensor.heat_pump_thermal_power_output') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Thermal Output | {{ states('sensor.heat_pump_thermal_power_output_kw') }}kW | / 1000 | {{ 'âœ…' if states('sensor.heat_pump_thermal_power_output_kw') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Thermal (kW) | {{ states('sensor.heat_pump_thermal_power_kw') }}kW | Mode-filtered | {{ 'âœ…' if states('sensor.heat_pump_thermal_power_kw') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Thermal (BTU/h) | {{ states('sensor.heat_pump_thermal_power_btu_h') }} BTU/h | kW Ã— 3412.14 | {{ 'âœ…' if states('sensor.heat_pump_thermal_power_btu_h') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      ## COP Calculation
      | Sensor | Value | Formula | Status |
      |--------|-------|---------|--------|
      | Current COP | {{ states('sensor.heat_pump_cop') }} | Thermal / Electrical | {{ 'âœ… Good (1.5-5.5)' if 1.5 < states('sensor.heat_pump_cop') | float(0) < 6 else ('N/A (off)' if is_state('binary_sensor.heat_pump_running', 'off') else 'âš ï¸') }} |
      | Efficiency Rating | {{ states('sensor.heat_pump_efficiency_rating') }} | COP â†’ Text | {{ 'âœ…' if states('sensor.heat_pump_efficiency_rating') != 'Unknown' else 'âš ï¸' }} |

      **Data Flow:** Modbus â†’ Raw Readings â†’ Power Calc (VÃ—I) â†’ Thermal Calc (Q=á¹CpÎ”T) â†’ COP

  # ===========================================================================
  # CARD 2: INTEGRATION SENSORS
  # ===========================================================================
  - type: markdown
    title: âš¡ Integration Sensors (legacy_sensors.yaml)
    content: |
      ## Integration Platform (Power â†’ Energy over time)
      | Sensor | Source | Value | Method | Status |
      |--------|--------|-------|--------|--------|
      | **CX Input Power kWh** | heat_pump_electrical_power_input (W) | {{ states('sensor.cx_input_power_kwh') }} kWh | Riemann (left) | {{ 'âœ… Accumulating' if states('sensor.cx_input_power_kwh') not in ['unknown', 'unavailable'] and states('sensor.cx_input_power_kwh') | float(-1) >= 0 else 'âŒ' }} |
      | **CX Output Power Interval** | heat_pump_thermal_power_output (W) | {{ states('sensor.cx_output_power_interval') }} kWh | Riemann (left) | {{ 'âœ… Accumulating' if states('sensor.cx_output_power_interval') not in ['unknown', 'unavailable'] and states('sensor.cx_output_power_interval') | float(-1) >= 0 else 'âŒ Not initialized yet' }} |

      ## Expected Relationship (Energy-Based COP)
      {% set input = states('sensor.cx_input_power_kwh') | float(0) %}
      {% set output = states('sensor.cx_output_power_interval') | float(0) %}
      {% if input > 1 and output > 0 %}
      | Metric | Value | Status |
      |--------|-------|--------|
      | Input Energy | {{ input | round(3) }} kWh | - |
      | Output Energy | {{ output | round(3) }} kWh | - |
      | **COP (Energy-based)** | **{{ (output / input) | round(2) }}** | {{ 'âœ… Reasonable (1.5-5.5)' if 1.5 < (output / input) < 6 else 'âš ï¸ Check values' }} |
      {% else %}
      **Status:** â³ Waiting for both sensors to accumulate (need > 1 kWh input)
      {% endif %}

      ## Statistics Platform (Moving averages)
      | Sensor | Source | Value | Window | Status |
      |--------|--------|-------|--------|--------|
      | House Delta T (24h Mean) | house_delta_t_c_raw | {{ states('sensor.house_delta_t_c_24_hour_mean') }}Â°C | 24h | {{ 'âœ…' if states('sensor.house_delta_t_c_24_hour_mean') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |
      | HLC Time Mean | house_heat_loss_coefficient_kw_c | {{ states('sensor.house_heat_loss_coefficient_kw_c_time_mean') }} kW/Â°C | 1h | {{ 'âœ…' if states('sensor.house_heat_loss_coefficient_kw_c_time_mean') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |

      ## Filter Platform (Noise reduction)
      | Sensor | Source | Value | Filters | Status |
      |--------|--------|-------|---------|--------|
      | Shed LC2 Power (Stable) | lc_shed_lc_watts | {{ states('sensor.shed_lc2_consumption_power_stable') }}W | Outlier + Moving Avg | {{ 'âœ…' if states('sensor.shed_lc2_consumption_power_stable') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |

      **Data Flow:** Power (W) â†’ Integration â†’ Energy (kWh) â†’ Utility Meters

      **Note:** Integration sensors created on 2025-11-12 to fix missing sensor definitions

  # ===========================================================================
  # CARD 3: CYCLE TRACKING SENSORS
  # ===========================================================================
  - type: markdown
    title: ğŸ”„ Cycle Tracking Sensors (heat_pump_cycle_sensors.yaml)
    content: |
      ## Binary Sensor Source
      | Sensor | Value | Based On |
      |--------|-------|----------|
      | Heat Pump Running | {{ states('binary_sensor.heat_pump_running') }} | Power > 500W |

      ## Trigger-Based Cycle Sensors (NEW 2025-11-12)
      | Sensor | Value | Unit | Trigger | Status |
      |--------|-------|------|---------|--------|
      | Current Cycle Duration | {{ states('sensor.heat_pump_current_cycle_duration') }} | seconds | State change + 1s pattern | {{ 'âœ… Incrementing' if states('sensor.heat_pump_current_cycle_duration') | float(0) > 0 and is_state('binary_sensor.heat_pump_running', 'on') else ('âœ… Zero (off)' if is_state('binary_sensor.heat_pump_running', 'off') else 'âš ï¸') }} |
      | Current Cycle Duration | {{ states('sensor.heat_pump_current_cycle_duration_minutes') }} | minutes | Divides above by 60 | {{ 'âœ… Matches' if ((states('sensor.heat_pump_current_cycle_duration') | float(0) / 60) | round(2) - states('sensor.heat_pump_current_cycle_duration_minutes') | float(0)) | abs < 0.1 else 'âš ï¸ Mismatch' }} |
      | Last Cycle Duration | {{ states('sensor.heat_pump_last_cycle_duration') }} | seconds | ONâ†’OFF transition | {{ 'âœ… Has data' if states('sensor.heat_pump_last_cycle_duration') | float(0) > 0 else 'âš ï¸ Waiting for cycle' }} |
      | Last Cycle COP | {{ states('sensor.heat_pump_last_cycle_cop') }} | - | ONâ†’OFF transition | {{ 'âœ… Captured' if states('sensor.heat_pump_last_cycle_cop') not in ['unknown', 'unavailable'] else 'âš ï¸ Waiting' }} |
      | Cycle Remaining | {{ states('sensor.heat_pump_current_cycle_remaining') }} | seconds | Target - Current | {{ 'âœ…' if states('sensor.heat_pump_current_cycle_remaining') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |
      | Min Runtime Target | {{ states('input_number.minimum_runtime_target') }} | minutes | Helper input | {{ 'âœ…' if states('input_number.minimum_runtime_target') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |

      ## Cycle Phases (Calculated from Duration)
      | Sensor | Value | Formula | Expected When |
      |--------|-------|---------|---------------|
      | Startup Phase | {{ states('binary_sensor.heat_pump_in_startup_phase') }} | cycle < 180s | ON during first 3min |
      | Steady State | {{ states('binary_sensor.heat_pump_steady_state') }} | cycle > 180s AND remain > 10s | ON after 3min |
      | Last Cycle Short | {{ states('binary_sensor.heat_pump_last_cycle_was_short') }} | last < 300s | ON if < 5min cycle |

      ## Validation
      {% set current_s = states('sensor.heat_pump_current_cycle_duration') | float(0) %}
      {% set current_m = states('sensor.heat_pump_current_cycle_duration_minutes') | float(0) %}
      {% set expected_m = (current_s / 60) | round(2) %}

      **Math Check:** {{ current_s }}s Ã· 60 = {{ expected_m }} min
      **Sensor Shows:** {{ current_m }} min
      {{ 'âœ… Match!' if (expected_m - current_m) | abs < 0.1 else 'âŒ MISMATCH - Sensor error!' }}

      **Data Flow:** binary_sensor.heat_pump_running â†’ Cycle Duration â†’ Binary States â†’ Automation Triggers

  # ===========================================================================
  # CARD 4: HVAC DISTRIBUTION SENSORS
  # ===========================================================================
  - type: markdown
    title: ğŸ  HVAC Distribution Sensors (hvac_sensors.yaml)
    content: |
      ## Buffer Tank Sensors
      | Sensor | Value | Source | Status |
      |--------|-------|--------|--------|
      | Supply Temp | {{ states('sensor.hvac_buffer_tank_supply_temperature') }}Â°F | Shelly temp | {{ 'âœ…' if states('sensor.hvac_buffer_tank_supply_temperature') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Return Temp | {{ states('sensor.hvac_buffer_tank_return_temperature') }}Â°F | Shelly temp_3 | {{ 'âœ…' if states('sensor.hvac_buffer_tank_return_temperature') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Delta T | {{ states('sensor.hvac_buffer_tank_delta_t') }}Â°F | Supply - Return | {{ 'âœ…' if states('sensor.hvac_buffer_tank_delta_t') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Delta T (C) | {{ states('sensor.hvac_buffer_tank_delta_t_celsius') }}Â°C | For calc | {{ 'âœ…' if states('sensor.hvac_buffer_tank_delta_t_celsius') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Flow Rate | {{ states('sensor.hvac_buffer_tank_flow_rate') }} LPM | Hydronic flow | {{ 'âœ…' if states('sensor.hvac_buffer_tank_flow_rate') | float(0) > 0 else 'âš ï¸ Zero' }} |

      ## Flow Sensor Comparison
      | Check | Value | Status |
      |-------|-------|--------|
      | CX Flow | {{ states('sensor.cx50_pump_flow_lpm') }} LPM | - |
      | Hydronic Flow | {{ states('sensor.hvac_buffer_tank_flow_rate') }} LPM | - |
      | Discrepancy Ratio | {{ states('sensor.flow_sensor_discrepancy_ratio') }} | {{ 'âœ… <1.5' if states('sensor.flow_sensor_discrepancy_ratio') | float(0) < 1.5 else 'âš ï¸' }} |
      | Analysis | {{ states('sensor.flow_sensor_discrepancy_analysis') }} | - |

      ## Thermal Power Used (House Load)
      | Sensor | Value | Formula | Status |
      |--------|-------|---------|--------|
      | HVAC Thermal Power | {{ states('sensor.hvac_thermal_power_used') }}W | Q = á¹ Ã— Cp Ã— Î”T | {{ 'âœ…' if states('sensor.hvac_thermal_power_used') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | House Heat Loss | {{ states('sensor.house_heat_loss_kw') }}kW | Same formula | {{ 'âœ…' if states('sensor.house_heat_loss_kw') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | House Heat Loss | {{ states('sensor.house_heat_loss_btu_h') }} BTU/h | kW Ã— 3412.14 | {{ 'âœ…' if states('sensor.house_heat_loss_btu_h') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      ## Distribution Efficiency
      | Metric | Value | Calculation | Status |
      |--------|-------|-------------|--------|
      | HP Output | {{ (states('sensor.heat_pump_thermal_power_output') | float(0) / 1000) | round(2) }}kW | From heat pump | - |
      | HVAC Load | {{ (states('sensor.hvac_thermal_power_used') | float(0) / 1000) | round(2) }}kW | From buffer tank | - |
      | Efficiency | {{ states('sensor.system_distribution_efficiency') }}% | (Load / Output) Ã— 100 | {{ 'âœ… >80%' if states('sensor.system_distribution_efficiency') | float(0) > 80 else ('âš ï¸ Expected in Heat+DHW mode' if states('sensor.heat_pump_operating_mode') in ['Heat + DHW', 'HEAT + DHW'] else 'âŒ') }} |
      | Loss Analysis | {{ states('sensor.system_loss_analysis') }} | - | - |

      ## Heat Loss Coefficient
      | Sensor | Value | Formula | Window | Status |
      |--------|-------|---------|--------|--------|
      | HLC (Instant) | {{ states('sensor.house_heat_loss_coefficient_kw_c') }} kW/Â°C | Heat Loss / Î”T | Current | {{ 'âœ…' if states('sensor.house_heat_loss_coefficient_kw_c') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |
      | HLC (1h Mean) | {{ states('sensor.house_heat_loss_coefficient_kw_c_time_mean') }} kW/Â°C | Statistics | 1 hour | {{ 'âœ…' if states('sensor.house_heat_loss_coefficient_kw_c_time_mean') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |
      | HLC (Energy-Based) | {{ states('sensor.house_heat_loss_coefficient_energy_based') }} kW/Â°C | Daily kWh / 24h / Î”T | 24 hour | {{ 'âœ…' if states('sensor.house_heat_loss_coefficient_energy_based') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |
      | Projected Max Loss | {{ states('sensor.house_projected_max_heat_loss_kw') }} kW | HLC Ã— Design Î”T | - | {{ 'âœ…' if states('sensor.house_projected_max_heat_loss_kw') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |

      **Data Flow:** Buffer Tank Sensors â†’ HVAC Load â†’ Distribution Efficiency & HLC

      **Note:** Low distribution efficiency in "Heat + DHW" mode is expected (energy goes to hot water tank)

  # ===========================================================================
  # CARD 5: UTILITY METERS
  # ===========================================================================
  - type: markdown
    title: ğŸ“Š Utility Meters (utility_meters.yaml)
    content: |
      ## Energy Output Meters (Source: cx_output_power_interval)
      | Meter | Value | Cycle | Source Status | Meter Status |
      |-------|-------|-------|---------------|--------------|
      | Hourly | {{ states('sensor.cx_hourly_energy_output') }} kWh | hourly | {{ 'âœ…' if states('sensor.cx_output_power_interval') not in ['unknown', 'unavailable'] else 'âŒ Source unavailable' }} | {{ 'âœ…' if states('sensor.cx_hourly_energy_output') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Daily | {{ states('sensor.cx_daily_energy_output') }} kWh | daily | {{ 'âœ…' if states('sensor.cx_output_power_interval') not in ['unknown', 'unavailable'] else 'âŒ Source unavailable' }} | {{ 'âœ…' if states('sensor.cx_daily_energy_output') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Monthly | {{ states('sensor.cx_monthly_energy_output') }} kWh | monthly | {{ 'âœ…' if states('sensor.cx_output_power_interval') not in ['unknown', 'unavailable'] else 'âŒ Source unavailable' }} | {{ 'âœ…' if states('sensor.cx_monthly_energy_output') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      ## Energy Input Meters (Source: cx_input_power_kwh)
      | Meter | Value | Cycle | Sanity Check | Status |
      |-------|-------|-------|--------------|--------|
      | Hourly | {{ states('sensor.cx_hourly_energy_input') }} kWh | hourly | {{ 'âœ… <100kWh' if states('sensor.cx_hourly_energy_input') | float(0) < 100 else 'âŒ TOO HIGH - Corrupted state' }} | {{ 'âœ…' if states('sensor.cx_hourly_energy_input') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Daily | {{ states('sensor.cx_daily_energy_input') }} kWh | daily | {{ 'âœ… <2000kWh' if states('sensor.cx_daily_energy_input') | float(0) < 2000 else 'âŒ TOO HIGH - Corrupted state' }} | {{ 'âœ…' if states('sensor.cx_daily_energy_input') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | Monthly | {{ states('sensor.cx_monthly_energy_input') }} kWh | monthly | {{ 'âœ… <60000kWh' if states('sensor.cx_monthly_energy_input') | float(0) < 60000 else 'âŒ TOO HIGH - Corrupted state' }} | {{ 'âœ…' if states('sensor.cx_monthly_energy_input') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      ## HVAC Thermal Energy (Daily tracking)
      | Meter | Value | Source | Status |
      |-------|-------|--------|--------|
      | HVAC Used (Daily) | {{ states('sensor.hvac_thermal_energy_used_daily') }} kWh | hvac_thermal_energy_used | {{ 'âœ…' if states('sensor.hvac_thermal_energy_used_daily') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | HP Produced (Daily) | {{ states('sensor.hvac_hp_thermal_energy_produced_daily') }} kWh | hp_heating_thermal_energy_kwh | {{ 'âœ…' if states('sensor.hvac_hp_thermal_energy_produced_daily') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      **Data Flow:** Integration Sensors â†’ Utility Meters â†’ Reset on Cycle (hourly/daily/monthly)

      {% set input_hourly = states('sensor.cx_hourly_energy_input') | float(0) %}
      {% if input_hourly > 1000 %}
      ## âš ï¸ ACTION REQUIRED
      Input meters have corrupted historical state from before sensor creation.
      Need to rename/delete entities like you did with cx_output_power_interval:
      1. Settings â†’ Devices & Services â†’ Entities
      2. Search for "cx_hourly_energy_input", "cx_daily_energy_input", "cx_monthly_energy_input"
      3. Rename each one (add "_old" suffix)
      4. Restart Home Assistant - new meters will initialize at 0
      {% endif %}

  # ===========================================================================
  # CARD 6: OPTIMIZATION SENSORS
  # ===========================================================================
  - type: markdown
    title: ğŸ¯ Optimization Sensors (cx_optimization_sensors.yaml)
    content: |
      ## Mode-Filtered Power Sensors
      | Sensor | Value | Mode Filter | Status |
      |--------|-------|-------------|--------|
      | HP Heating Electrical (kW) | {{ states('sensor.hp_heating_electrical_power_kw') }} | Heat or HEAT+DHW | {{ 'âœ…' if states('sensor.hp_heating_electrical_power_kw') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | HP Heating Thermal (kW) | {{ states('sensor.hp_heating_thermal_power_kw') }} | Heat or HEAT+DHW | {{ 'âœ…' if states('sensor.hp_heating_thermal_power_kw') not in ['unknown', 'unavailable'] else 'âŒ' }} |
      | HP Space Heating Only (kW) | {{ states('sensor.hp_space_heating_thermal_power_kw') }} | Heat ONLY (no DHW) | {{ 'âœ…' if states('sensor.hp_space_heating_thermal_power_kw') not in ['unknown', 'unavailable'] else 'âŒ' }} |

      ## Performance Metrics
      | Sensor | Value | Formula | Status |
      |--------|-------|---------|--------|
      | Current COP | {{ states('sensor.heat_pump_cop') }} | Thermal / Electrical | {{ 'âœ… Good' if 1.5 < states('sensor.heat_pump_cop') | float(0) < 6 else 'N/A' }} |
      | Last Cycle COP | {{ states('sensor.heat_pump_last_cycle_cop') }} | Captured at cycle end | {{ 'âœ…' if states('sensor.heat_pump_last_cycle_cop') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |
      | Avg Steady State COP | {{ states('sensor.heat_pump_average_steady_state_cop') }} | Updates when steady | {{ 'âœ…' if states('sensor.heat_pump_average_steady_state_cop') not in ['unknown', 'unavailable'] else 'âš ï¸ Needs cycles' }} |
      | Distribution Eff (Daily) | {{ states('sensor.system_distribution_efficiency_daily') }}% | Daily kWh ratio | {{ 'âœ…' if states('sensor.system_distribution_efficiency_daily') not in ['unknown', 'unavailable'] else 'âš ï¸' }} |

      ## Binary Status Sensors
      | Sensor | State | Based On |
      |--------|-------|----------|
      | HP Running | {{ states('binary_sensor.heat_pump_running') }} | Power > 500W |
      | In Startup Phase | {{ states('binary_sensor.heat_pump_in_startup_phase') }} | Cycle < 180s |
      | Steady State | {{ states('binary_sensor.heat_pump_steady_state') }} | Cycle > 180s & remain > 10s |
      | Last Cycle Short | {{ states('binary_sensor.heat_pump_last_cycle_was_short') }} | Last < 300s |

      **Data Flow:** Operating Mode â†’ Filter Power Sensors â†’ COP Tracking â†’ Optimization Logic
